#!/usr/bin/env node

var rw = require("../");

var reader = rw.reader(process.argv[2] || "/dev/stdin"),
    writer = rw.writer(process.argv[3] || "/dev/stdout");

reader.fill(function pipe(error) {
  if (error) throw error;

  if (reader.available) {
    if (writer.available < reader.available) return writer.flush(pipe);
    writer.write(reader.read());
  }

  if (reader.ended) return writer.end(function(error) { if (error) throw error; });

  // TODO Have to flush before reading due to memory reuse.
  writer.flush(function(error) {
    if (error) throw error;
    reader.fill(pipe);
  })
});
