#!/usr/bin/env node

var rw = require("../");

var reader = rw.fileReader(process.argv[2] || "/dev/stdin"),
    writer = rw.fileWriter(process.argv[3] || "/dev/stdout");

reader.fill(filled);

function filled(error) {
  if (error) throw error;
  while (reader.available >= 10 && writer.available >= 10) writer.write(reader.read(10));
  if (reader.available >= 10) writer.flush(filled);
  else if (reader.ended) writer.end(ended);
  else writer.flush(flushed);
}

function flushed(error) {
  if (error) throw error;
  reader.fill(filled);
}

function ended(error) {
  if (error) throw error;
}
