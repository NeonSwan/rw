#!/usr/bin/env node

var rw = require("../");

var reader = rw.fileReader(process.argv[2] || "/dev/stdin"),
    writer = rw.fileWriter(process.argv[3] || "/dev/stdout");

readMore(null);

function readMore(error) {
  if (error) throw error;
  reader.fill(writeMore);
}

function writeMore(error) {
  if (error) throw error;
  var record;

  while ((record = reader.read(10)) != null) {
    if (!writer.write(record)) {
      return writer.drain(writeMore);
    }
  }

  if (reader.ended) return writer.end(end);

  writer.drain(readMore); // must drain before filling!
}

function end(error) {
  if (error) throw error;
}
